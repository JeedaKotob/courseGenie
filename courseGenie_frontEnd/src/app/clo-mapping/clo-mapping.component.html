<div class="m-3">
  <app-course-header
    [course]="course"
    [buttons]="headerButtons"
    (buttonClick)="handleHeaderAction($event)">
  </app-course-header>

      <!-- SUCCESS / ERROR MESSAGES -->
      <div class="messages mb-4">
        <div *ngIf="showSuccessMessage" class="alert-box success">
          <div class="alert-content">
            <i class="bi bi-check-circle-fill me-2"></i>
            <span>CLO mappings saved successfully!</span>
          </div>
          <button class="alert-close" (click)="closeSuccessMessage()" aria-label="Close">
            <i class="bi bi-x"></i>
          </button>
        </div>

        <div *ngIf="showAssessmentError" class="alert-box error">
          <div class="alert-content">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <span>Each assessment must be mapped to at least one CLO.</span>
          </div>
          <button class="alert-close" (click)="closeAssessmentError()" aria-label="Close">
            <i class="bi bi-x"></i>
          </button>
        </div>

        <div *ngIf="showCloError" class="alert-box error">
          <div class="alert-content">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <span>Each CLO must be mapped to at least two assessments.</span>
          </div>
          <button class="alert-close" (click)="closeCloError()" aria-label="Close">
            <i class="bi bi-x"></i>
          </button>
        </div>
      </div>

      <!-- Info Box -->
      <div class="info-box mb-4">
        <div class="info-icon">
          <i class="bi bi-info-circle-fill"></i>
        </div>
        <div class="info-content">
          <h5>Mapping Instructions</h5>
          <p>Check the boxes to map assessments to course learning outcomes (CLOs). Each assessment must be mapped to at least one CLO, and each CLO must be mapped to at least two assessments.</p>
        </div>
      </div>

      <div class="mapping-container">
        <div class="table-responsive">
          <table class="mapping-table">
            <thead>
            <tr>
              <th class="assessment-header">Assessment</th>
              <th *ngFor="let clo of course?.clos" class="clo-header">
                <div class="clo-name-container">
                  <span class="clo-name">{{ clo.name }}</span>
                  <span class="clo-tooltip" title="{{ clo.description }}">
                      <i class="bi bi-info-circle"></i>
                    </span>
                </div>
              </th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let assessment of course?.sections?.[0]?.assessments">
              <td class="assessment-name">
                {{ assessment.name }}
                <div class="assessment-details">{{ assessment.maxPoints }}%</div>
              </td>
              <td *ngFor="let clo of course?.clos" class="mapping-cell">
                <div class="custom-checkbox">
                  <input
                    type="checkbox"
                    [id]="'check-' + assessment.assessmentId + '-' + clo.cloId"
                    [checked]="isChecked(assessment.assessmentId, clo.cloId)"
                    (change)="onCheckboxChange($event, assessment.assessmentId, clo.cloId)"
                  />
                  <label [for]="'check-' + assessment.assessmentId + '-' + clo.cloId"></label>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>


<style>
  /* Main container */
  .card {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    border: none;
  }

  .card-inner {
    background-color: white;
    border-radius: 8px;
  }

  .course-title {
    font-size: 1.4rem;
    font-weight: 600;
    color: #024964;
    margin-bottom: 0;
  }

  /* Alert messages */
  .messages {
    position: relative;
  }

  .alert-box {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 10px;
    transition: opacity 0.3s ease;
  }

  .alert-box.success {
    background-color: #d4edda;
    color: #155724;
    border-left: 4px solid #28a745;
  }

  .alert-box.error {
    background-color: #f8d7da;
    color: #721c24;
    border-left: 4px solid #dc3545;
  }

  .alert-content {
    display: flex;
    align-items: center;
  }

  .alert-close {
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
    padding: 0;
    font-size: 1.1rem;
  }

  /* Info box */
  .info-box {
    display: flex;
    padding: 16px;
    background-color: #e8f4f8;
    border-radius: 8px;
    border-left: 4px solid #0394CA;
  }

  .info-icon {
    font-size: 1.5rem;
    color: #0394CA;
    margin-right: 16px;
    display: flex;
    align-items: center;
  }

  .info-content h5 {
    margin-top: 0;
    margin-bottom: 6px;
    font-size: 1.1rem;
    color: #024964;
  }

  .info-content p {
    margin-bottom: 0;
    color: #495057;
  }

  /* Mapping table */
  .mapping-container {
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #dee2e6;
  }

  .mapping-table {
    width: 100%;
    border-collapse: collapse;
  }

  .mapping-table th, .mapping-table td {
    border: 1px solid #dee2e6;
    padding: 12px;
    text-align: center;
    vertical-align: middle;
  }

  .assessment-header {
    background-color: #f8f9fa;
    font-weight: 600;
    text-align: left;
    min-width: 200px;
  }

  .clo-header {
    background-color: #f8f9fa;
    font-weight: 600;
    min-width: 100px;
  }

  .clo-name-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .clo-tooltip {
    color: #6c757d;
    cursor: help;
  }

  .assessment-name {
    font-weight: 600;
    text-align: left;
    background-color: #f8f9fa;
  }

  .assessment-details {
    font-size: 0.85rem;
    color: #6c757d;
    font-weight: normal;
    margin-top: 4px;
  }

  .mapping-cell {
    background-color: white;
  }

  .mapping-cell:hover {
    background-color: #f1f9fb;
  }

  /* Custom checkbox */
  .custom-checkbox {
    position: relative;
    display: flex;
    justify-content: center;
  }

  .custom-checkbox input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
  }

  .custom-checkbox label {
    position: relative;
    cursor: pointer;
    padding: 0;
    display: inline-block;
    height: 24px;
    width: 24px;
    border: 2px solid #ccc;
    border-radius: 4px;
    background-color: white;
    transition: all 0.2s ease;
    margin: 0;
  }

  .custom-checkbox input[type="checkbox"]:checked + label {
    background-color: #0394CA;
    border-color: #0394CA;
  }

  .custom-checkbox input[type="checkbox"]:checked + label:after {
    content: "";
    position: absolute;
    left: 7px;
    top: 3px;
    width: 6px;
    height: 12px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
  }

  .custom-checkbox label:hover {
    border-color: #0394CA;
  }

  /* Media queries */
  @media (max-width: 768px) {
    .header {
      flex-direction: column;
      align-items: flex-start;
    }

    .header > div {
      margin-top: 12px;
    }

    .course-title {
      font-size: 1.2rem;
    }
  }
</style>
